<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµŒé¨“ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</title>
    <style>
        /* --- å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        body { font-family: sans-serif; max-width: 700px; margin: 20px auto; background-color: #f0f0f0; padding-bottom: 20px; }
        .header { display: flex; justify-content: center; align-items: center; position: relative; gap: 10px; }
        h1 { text-align: center; color: #333; margin: 20px 0; }

        /* --- ã€Œä½¿ã„æ–¹ã€ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .how-to-use {
            margin: 0 auto 20px auto;
            border: 1px solid #ccc;
            background-color: #fff;
            border-radius: 5px;
        }
        .how-to-use summary {
            font-weight: bold;
            padding: 10px;
            cursor: pointer;
            outline: none;
        }
        .how-to-use div {
            padding: 0 15px 15px 15px;
            border-top: 1px solid #eee;
            line-height: 1.6;
        }
        .how-to-use p {
            margin: 10px 0;
        }

        /* --- ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        #mode-toggle-button, #layout-toggle-button {
            display: none; /* åŸºæœ¬ã¯éè¡¨ç¤º */
            background-color: #555; color: white; border: none;
            padding: 8px 12px; border-radius: 4px; cursor: pointer; white-space: nowrap;
        }

        /* --- ã‚¿ãƒ–ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .tab-buttons { overflow: hidden; border-bottom: 2px solid #ccc; background: white; }
        .tab-buttons button.tab-link { background-color: #f1f1f1; float: left; border: none; outline: none; cursor: pointer; padding: 10px 15px; font-size: 16px; transition: 0.3s; display: flex; align-items: center; justify-content: space-between; }
        .tab-buttons button.tab-link:hover { background-color: #ddd; }
        .tab-buttons button.tab-link.active { background-color: #ccc; font-weight: bold; }
        .char-name { padding-right: 10px; white-space: nowrap; }
        .char-name:hover { background-color: #ffecb3; cursor: pointer; border-radius: 3px; }
        .delete-tab-button { background: #ccc; color: #555; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 14px; line-height: 20px; text-align: center; cursor: pointer; transition: 0.2s; flex-shrink: 0; }
        .delete-tab-button:hover { background: #f44336; color: white; }
        #add-tab-button { background-color: #a0cda0; float: left; border: none; cursor: pointer; padding: 10px 15px; font-weight: bold; font-size: 20px; border-radius: 5px 5px 0 0; }
        #add-tab-button:hover { background-color: #8bc38b; }

        /* --- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚·ãƒ¼ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .tab-content { display: none; padding: 20px; border-top: none; background-color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-content h2 { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #666; padding-bottom: 5px; margin-top: 0; }
        .reset-button { background-color: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; white-space: nowrap; }
        .reset-button:hover { background-color: #d32f2f; }
        
        /* --- æŠ€èƒ½ã‚«ãƒ†ã‚´ãƒªã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .skill-category { margin-bottom: 20px; }
        .skill-category h3 { margin: 0 0 10px 0; padding-bottom: 5px; border-bottom: 1px dashed #ccc; font-size: 18px; }
        .skill-list { list-style: none; padding-left: 0; margin: 0; }
        .skill-list li { padding: 8px 5px; border-bottom: 1px solid #eee; display: flex; align-items: center; }
        .skill-list li:last-child { border-bottom: none; }
        .skill-list label { display: flex; align-items: center; flex-grow: 1; cursor: pointer; }
        .skill-list input[type="checkbox"] { margin-right: 10px; }
        
        /* --- ç‰¹æ®ŠãªæŠ€èƒ½æ¬„ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .critical-counter { width: 40px; text-align: right; margin-right: 8px; flex-shrink: 0; }
        .mythos-start-input { width: 40px; text-align: right; }
        .growth-input { width: 50px; text-align: right; }
        .skill-specialization { border: 1px solid #ccc; padding: 4px; margin-left: 8px; width: 100px; }
        .custom-skill-input { border: 1px solid #ccc; padding: 4px; flex-grow: 1; margin-right: 10px; min-width: 50px; }
        .add-skill-button { padding: 2px 8px; font-weight: bold; cursor: pointer; border: 1px solid #ccc; background: #f0f0f0; }

        /* --- ãƒ¡ãƒ¢æ¬„ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .memo-area { width: 100%; height: 100px; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; resize: vertical; font-size: 14px; }

        /* --- ã‚µãƒãƒªãƒ¼å‡ºåŠ›æ¬„ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .summary-section { margin-top: 30px; padding: 20px; background-color: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .summary-header { display: flex; justify-content: space-between; align-items: center; }
        #summary-output { width: 100%; height: 250px; margin-top: 10px; font-family: monospace; font-size: 14px; white-space: pre-wrap; }
        #copy-summary-button { background-color: #1E88E5; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; }
        #copy-summary-button:hover { background-color: #1565C0; }

        /* --- ã‚¹ãƒãƒ›ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        @media (max-width: 799px) {
            body { margin: 0; padding: 10px; }
            h1 { font-size: 24px; }
            .header { flex-direction: column; gap: 0; }
            .tab-buttons { overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; }
            .tab-buttons button.tab-link, #add-tab-button { float: none; display: inline-block; }
            .tab-content, .summary-section { padding: 15px; }
            h2 { font-size: 20px; }
        }
        
        /* --- PCãªã©ã®åºƒã„ç”»é¢ç”¨ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« --- */
        @media (min-width: 800px) {
            body { max-width: 95%; }
            #mode-toggle-button { display: inline-block; }
        }

        /* --- ãƒ¯ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰ãŒONã®æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        body.wide-mode-on #layout-toggle-button { display: inline-block; }
        body.wide-mode-on .tab-content { display: block !important; border-top: 1px solid #ccc; }
        body.wide-mode-on .summary-section { display: none; }
        
        /* ãƒ¯ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¡¨ç¤ºï¼‰ */
        body.wide-mode-on #sheets-container {
            display: grid;
            grid-auto-flow: column;
            grid-auto-columns: 360px;
            gap: 20px;
            overflow-x: auto;
            padding-bottom: 15px;
        }
        
        /* ãƒ¯ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã§ãƒ•ã‚£ãƒƒãƒˆè¡¨ç¤ºãŒONã®æ™‚ */
        body.wide-mode-on.fit-mode-on #sheets-container {
            grid-auto-flow: row;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            overflow-x: hidden;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>çµŒé¨“ãƒ­ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</h1>
        <div>
            <button id="mode-toggle-button">ãƒ¯ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ</button>
            <button id="layout-toggle-button">ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å¹…ã«åˆã‚ã›ã‚‹</button>
        </div>
    </div>
    
    <details class="how-to-use">
        <summary>ğŸ² ã“ã®ãƒ„ãƒ¼ãƒ«ã®ä½¿ã„æ–¹</summary>
        <div>
            <p><strong>ã“ã®ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦:</strong> åˆå›æˆåŠŸã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒ­ã‚°å‡ºåŠ›ã§æ•°ãˆã‚‹ã®ãŒé¢å€’ã ã£ãŸã®ã§ã€ãã®å ´ãã®å ´ã§è¨˜éŒ²ã§ãã‚‹ã‚ˆã†ä½œã‚Šã¾ã—ãŸã€‚ã‚‚ã¡ã‚ã‚“åˆæœŸå€¤æˆåŠŸ/æ±ºå®šçš„æˆåŠŸã®ã¿ã‚«ã‚¦ãƒ³ãƒˆã®ãƒã‚¦ã‚¹ãƒ«ãƒ¼ãƒ«ã§ã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚</p>
            <p><strong>ã‚·ãƒ¼ãƒˆè¿½åŠ :</strong> ä¸Šéƒ¨ã®ã€Œï¼‹ã€ãƒœã‚¿ãƒ³ã§æ–°ã—ã„ã‚¿ãƒ–ã‚’è¿½åŠ ã§ãã¾ã™ã€‚</p>
            <p><strong>ã‚·ãƒ¼ãƒˆå‰Šé™¤:</strong> å„ã‚¿ãƒ–ã®å³å´ã«ã‚ã‚‹ã€ŒÃ—ã€ãƒœã‚¿ãƒ³ã§ã€ãã®ã‚·ãƒ¼ãƒˆã‚’å‰Šé™¤ã§ãã¾ã™ï¼ˆç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰ã€‚</p>
            <p><strong>åå‰ã®å¤‰æ›´:</strong> æ¢ç´¢è€…åï¼ˆã‚¿ãƒ–ã¾ãŸã¯ã‚·ãƒ¼ãƒˆä¸Šéƒ¨ï¼‰ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€åå‰ã‚’ç·¨é›†ã§ãã¾ã™ã€‚</p>
            <p><strong>ã‚·ãƒ¼ãƒˆã®ãƒªã‚»ãƒƒãƒˆ:</strong> å„ã‚·ãƒ¼ãƒˆã®å³ä¸Šã«ã‚ã‚‹ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã§ã€ãã®æ¢ç´¢è€…ã®å…¥åŠ›å†…å®¹ã‚’å…¨ã¦åˆæœŸåŒ–ã§ãã¾ã™ã€‚</p>
            <p><strong>ã‚«ã‚¹ã‚¿ãƒ æŠ€èƒ½ã®è¿½åŠ :</strong> å„æŠ€èƒ½ã‚«ãƒ†ã‚´ãƒªã®æœ«å°¾ã«ã‚ã‚‹å…¥åŠ›æ¬„ã«æŠ€èƒ½åã‚’å…¥ã‚Œã¦ã€Œï¼‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€è‡ªç”±ãªæŠ€èƒ½ã‚’è¿½åŠ ã§ãã¾ã™ã€‚ã‚µãƒ—ãƒªè¿½åŠ æŠ€èƒ½ã€7ç‰ˆæŠ€èƒ½ãªã©ãŒå¿…è¦ãªæ™‚ã«ä½¿ã£ã¦ãã ã•ã„ã€‚</p>
            <p><strong>è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ (PC):</strong> åºƒã„ç”»é¢ã§è¦‹ã‚‹ã¨ã€ã‚¿ã‚¤ãƒˆãƒ«æ¨ªã«è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
            <p><strong>ãƒ¯ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰:</strong> è¤‡æ•°ã®ãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆã‚’åŒæ™‚ã«ä¸¦ã¹ã¦è¡¨ç¤ºã—ã¾ã™ã€‚ã‚µãƒãƒªãƒ¼æ¬„ã¯éè¡¨ç¤ºã«ãªã‚Šã¾ã™ã€‚</p>
            <p><strong>é€šå¸¸è¡¨ç¤º:</strong> å¾“æ¥é€šã‚Šã€ã‚¿ãƒ–ã§æ¢ç´¢è€…ã‚’åˆ‡ã‚Šæ›¿ãˆã¦è¡¨ç¤ºã—ã¾ã™ã€‚</p>
            <p><strong>ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ‡æ›¿ (ãƒ¯ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰æ™‚):</strong> ãƒ¯ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰ä¸­ã«ã€ã‚·ãƒ¼ãƒˆã®ä¸¦ã¹æ–¹ã‚’ã€Œæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã€ã¨ã€Œã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å¹…ã«åˆã‚ã›ã‚‹ï¼ˆæŠ˜ã‚Šè¿”ã—ï¼‰ã€ã§åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™ã€‚</p>
            <p><strong>ã‚µãƒãƒªãƒ¼å‡ºåŠ› (é€šå¸¸è¡¨ç¤ºæ™‚):</strong> ãƒšãƒ¼ã‚¸æœ€ä¸‹éƒ¨ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«ã€ç¾åœ¨é–‹ã„ã¦ã„ã‚‹ã‚¿ãƒ–ã®çµŒé¨“ãƒ­ãƒ¼ãƒ«æƒ…å ±ãŒè‡ªå‹•ã§ã¾ã¨ã‚ã‚‰ã‚Œã¾ã™ã€‚ã€Œã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã€ãƒœã‚¿ãƒ³ã§ã‚³ãƒ”ãƒ¼ã§ãã¾ã™ã€‚</p>
        </div>
    </details>

    <div class="tab-buttons">
        <button class="tab-link active" onclick="openCharSheet(event, 'char1')">
            <span class="char-name" data-char-id="char1">æ¢ç´¢è€…1</span>
            <button class="delete-tab-button">Ã—</button>
        </button>
        <button id="add-tab-button">+</button>
    </div>

    <div id="sheets-container">
        <div id="char1" class="tab-content" style="display: block;"></div>
    </div>

    <div class="summary-section">
        <div class="summary-header">
            <h2>ã‚µãƒãƒªãƒ¼å‡ºåŠ›</h2>
            <button id="copy-summary-button">ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼</button>
        </div>
        <textarea id="summary-output" readonly placeholder="ã“ã“ã«ç¾åœ¨é–‹ã„ã¦ã„ã‚‹æ¢ç´¢è€…ã®ã‚µãƒãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"></textarea>
    </div>

    <template id="sheet-template"></template>

    <script>
        // (JavaScriptã®ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ã‚ã‚Šã¾ã›ã‚“)
        let charCount = 1;

        function toggleWideMode() {
            const body = document.body;
            const button = document.getElementById('mode-toggle-button');
            const layoutButton = document.getElementById('layout-toggle-button');
            body.classList.toggle('wide-mode-on');

            if (body.classList.contains('wide-mode-on')) {
                button.textContent = 'é€šå¸¸è¡¨ç¤ºã«æˆ»ã™';
            } else {
                button.textContent = 'ãƒ¯ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ';
                body.classList.remove('fit-mode-on');
                layoutButton.textContent = 'ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å¹…ã«åˆã‚ã›ã‚‹';
                document.querySelector('.tab-link.active').click();
            }
        }

        function toggleLayoutMode() {
            const body = document.body;
            const button = document.getElementById('layout-toggle-button');
            body.classList.toggle('fit-mode-on');

            if (body.classList.contains('fit-mode-on')) {
                button.textContent = 'ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆ';
            } else {
                button.textContent = 'ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å¹…ã«åˆã‚ã›ã‚‹';
            }
        }

        function openCharSheet(evt, charId) {
            if (evt.target.classList.contains('delete-tab-button')) return;
            document.querySelectorAll('.tab-content').forEach(tc => tc.style.display = 'none');
            document.querySelectorAll('.tab-link').forEach(tl => tl.classList.remove('active'));
            document.getElementById(charId).style.display = 'block';
            evt.currentTarget.classList.add('active');
            updateSummary();
        }

        function addCharSheet() {
            charCount++;
            const newCharId = 'char' + charCount;
            const newCharName = 'æ¢ç´¢è€…' + charCount;
            const newButton = document.createElement('button');
            newButton.className = 'tab-link';
            newButton.onclick = (event) => openCharSheet(event, newCharId);
            newButton.innerHTML = `<span class="char-name" data-char-id="${newCharId}">${newCharName}</span><button class="delete-tab-button">Ã—</button>`;
            const newSheet = document.createElement('div');
            newSheet.id = newCharId;
            newSheet.className = 'tab-content';
            const template = document.getElementById('sheet-template').innerHTML;
            newSheet.innerHTML = `<h2><div><span class="char-name" data-char-id="${newCharId}">${newCharName}</span>ã®æŠ€èƒ½</div><button class="reset-button">ãƒªã‚»ãƒƒãƒˆ</button></h2>` + template;
            document.getElementById('add-tab-button').before(newButton);
            document.getElementById('sheets-container').appendChild(newSheet);
            newSheet.querySelector('.reset-button').addEventListener('click', resetSheet);
            newButton.querySelector('.delete-tab-button').addEventListener('click', deleteSheet);
            newButton.click();
        }

        function handleNameEdit(event) {
            const targetSpan = event.target;
            if (!targetSpan.classList.contains('char-name')) return;
            const originalSpan = targetSpan;
            const charId = originalSpan.dataset.charId;
            const input = document.createElement('input');
            input.type = 'text';
            input.value = originalSpan.textContent;
            originalSpan.replaceWith(input);
            input.focus();
            const saveName = () => {
                const newName = input.value.trim() || 'åç§°æœªè¨­å®š';
                document.querySelectorAll(`.char-name[data-char-id="${charId}"]`).forEach(span => {
                    span.textContent = newName;
                });
                input.replaceWith(originalSpan);
                updateSummary();
            };
            input.addEventListener('blur', saveName);
            input.addEventListener('keydown', (e) => { if (e.key === 'Enter') saveName(); });
        }

        function addCustomSkill(event) {
            const li = event.target.parentElement;
            const input = li.querySelector('.custom-skill-input');
            const skillName = input.value.trim();
            if (!skillName) { alert("æŠ€èƒ½åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"); return; }
            const newLi = document.createElement('li');
            newLi.className = 'custom-skill';
            newLi.innerHTML = `<input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ${skillName}</label>`;
            li.before(newLi);
            input.value = "";
            updateSummary();
        }

        function resetSheet(event) {
            if (!confirm("ã“ã®æ¢ç´¢è€…ã®æƒ…å ±ã‚’æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) return;
            const sheet = event.currentTarget.closest('.tab-content');
            const charId = sheet.id;
            sheet.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            sheet.querySelectorAll('input[type="number"], input[type="text"]').forEach(num => num.value = '');
            sheet.querySelector('.memo-area').value = '';
            sheet.querySelectorAll('.custom-skill').forEach(skill => skill.remove());
            const defaultName = 'æ¢ç´¢è€…' + charId.replace('char', '');
            document.querySelectorAll(`.char-name[data-char-id="${charId}"]`).forEach(span => span.textContent = defaultName);
            updateSummary();
        }

        function deleteSheet(event) {
            event.stopPropagation();
            if (document.querySelectorAll('.tab-link').length <= 1) { alert("æœ€å¾Œã®ã‚¿ãƒ–ã¯å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚"); return; }
            if (!confirm("ã“ã®æ¢ç´¢è€…ã‚’æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
            const tabButton = event.currentTarget.closest('.tab-link');
            const charId = tabButton.querySelector('.char-name').dataset.charId;
            const wasActive = tabButton.classList.contains('active');
            tabButton.remove();
            document.getElementById(charId).remove();
            if (wasActive) document.querySelector('.tab-link').click();
            else updateSummary();
        }

        function updateSummary() {
            const activeTab = document.querySelector('.tab-link.active');
            const summaryOutput = document.getElementById('summary-output');
            if (!activeTab) { summaryOutput.value = ""; return; }
            const charId = activeTab.querySelector('.char-name').dataset.charId;
            const sheet = document.getElementById(charId);
            if (!sheet) return;
            const charName = sheet.querySelector('.char-name').textContent;
            let criticalSkills = [];
            let checkedSkills = [];
            sheet.querySelectorAll('.skill-list li').forEach(li => {
                const criticalInput = li.querySelector('.critical-counter');
                const checkbox = li.querySelector('input[type="checkbox"]');
                const skillLabel = li.querySelector('label');
                if (skillLabel) {
                    let skillName = skillLabel.textContent.trim();
                    const specializationInput = li.querySelector('.skill-specialization');
                    if (specializationInput && specializationInput.value.trim() !== '') {
                        skillName += `(${specializationInput.value.trim()})`;
                    }
                    if (criticalInput && criticalInput.value > 0) criticalSkills.push(`ãƒ»${skillName} : ${criticalInput.value}å›`);
                    if (checkbox && checkbox.checked) checkedSkills.push(`ãƒ»${skillName}`);
                }
            });
            const mythosStart = sheet.querySelector('.mythos-start-input').value || '0';
            const mythosGrowth = sheet.querySelector('.growth-input').value || '0';
            const memoContent = sheet.querySelector('.memo-area').value.trim();
            let summaryText = `â– æ¢ç´¢è€…åï¼š ${charName}\n\n`;
            summaryText += 'â–¼ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã—ãŸæŠ€èƒ½\n';
            summaryText += criticalSkills.length > 0 ? criticalSkills.join('\n') + '\n\n' : 'ãªã—\n\n';
            summaryText += 'â–¼ãƒã‚§ãƒƒã‚¯ã—ãŸæŠ€èƒ½ï¼ˆåˆæœŸå€¤æˆåŠŸå«ã‚€ï¼‰\n';
            summaryText += checkedSkills.length > 0 ? checkedSkills.join('\n') + '\n\n' : 'ãªã—\n\n';
            summaryText += `â–¼ã‚¯ãƒˆã‚¥ãƒ«ãƒ•ç¥è©±æŠ€èƒ½ï¼š ${mythosStart} + ${mythosGrowth}%\n\n`;
            summaryText += 'â–¼è‡ªç”±ãƒ¡ãƒ¢æ¬„\n';
            summaryText += memoContent !== '' ? memoContent : 'ãªã—';
            summaryOutput.value = summaryText;
        }
        
        function copySummary() {
            const summaryOutput = document.getElementById('summary-output');
            const button = document.getElementById('copy-summary-button');
            navigator.clipboard.writeText(summaryOutput.value).then(() => {
                const originalText = button.textContent;
                button.textContent = 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
                setTimeout(() => { button.textContent = originalText; }, 2000);
            }, () => { alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚'); });
        }

        function initialize() {
            const templateHolder = document.getElementById('sheet-template');
            templateHolder.innerHTML = `
                <div class="skill-category"><h3>æˆ¦é—˜æŠ€èƒ½</h3><ul class="skill-list"><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> å›é¿</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ã‚­ãƒƒã‚¯</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> çµ„ã¿ä»˜ã</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ã“ã¶ã—ï¼ˆãƒ‘ãƒ³ãƒï¼‰</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> é ­çªã</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> æŠ•æ“²</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ãƒãƒ¼ã‚·ãƒ£ãƒ«ã‚¢ãƒ¼ãƒ„</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> æ‹³éŠƒ</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ã‚µãƒ–ãƒã‚·ãƒ³ã‚¬ãƒ³</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ã‚·ãƒ§ãƒƒãƒˆã‚¬ãƒ³</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ãƒã‚·ãƒ³ã‚¬ãƒ³</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ãƒ©ã‚¤ãƒ•ãƒ«</label></li><li><input type="text" class="custom-skill-input" placeholder="æŠ€èƒ½åã‚’å…¥åŠ›"><button class="add-skill-button">+</button></li></ul></div>
                <div class="skill-category"><h3>æ¢ç´¢æŠ€èƒ½</h3><ul class="skill-list"><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> å¿œæ€¥æ‰‹å½“</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> éµé–‹ã‘</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> éš ã™</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> éš ã‚Œã‚‹</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> èãè€³</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> å¿ã³æ­©ã</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> å†™çœŸè¡“</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ç²¾ç¥åˆ†æ</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> è¿½è·¡</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ç™»æ”€</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> å›³æ›¸é¤¨</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ç›®æ˜Ÿ</label></li><li><input type="text" class="custom-skill-input" placeholder="æŠ€èƒ½åã‚’å…¥åŠ›"><button class="add-skill-button">+</button></li></ul></div>
                <div class="skill-category"><h3>è¡Œå‹•æŠ€èƒ½</h3><ul class="skill-list"><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> é‹è»¢</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> æ©Ÿæ¢°ä¿®ç†</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> é‡æ©Ÿæ¢°æ“ä½œ</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ä¹—é¦¬</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> æ°´æ³³</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> è£½ä½œ</label><input type="text" class="skill-specialization" placeholder="å°‚é–€åˆ†é‡"></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> æ“ç¸¦</label><input type="text" class="skill-specialization" placeholder="å°‚é–€åˆ†é‡"></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> è·³èº</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> é›»æ°—ä¿®ç†</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ãƒŠãƒ“ã‚²ãƒ¼ãƒˆ</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> å¤‰è£…</label></li><li><input type="text" class="custom-skill-input" placeholder="æŠ€èƒ½åã‚’å…¥åŠ›"><button class="add-skill-button">+</button></li></ul></div>
                <div class="skill-category"><h3>äº¤æ¸‰æŠ€èƒ½</h3><ul class="skill-list"><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> è¨€ã„ãã‚‹ã‚</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ä¿¡ç”¨</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> èª¬å¾—</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> å€¤åˆ‡ã‚Š</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> æ¯å›½èª</label></li><li><input type="text" class="custom-skill-input" placeholder="æŠ€èƒ½åã‚’å…¥åŠ›"><button class="add-skill-button">+</button></li></ul></div>
                <div class="skill-category"><h3>çŸ¥è­˜æŠ€èƒ½</h3><ul class="skill-list"><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> åŒ»å­¦</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ã‚ªã‚«ãƒ«ãƒˆ</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> åŒ–å­¦</label></li>
                    <li><span>ã‚¯ãƒˆã‚¥ãƒ«ãƒ•ç¥è©±</span><div><input type="number" class="mythos-start-input" min="0" placeholder="é–‹å§‹å€¤"> + <input type="number" class="growth-input" min="0" placeholder="0">% æˆé•·</div></li>
                <li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> èŠ¸è¡“</label><input type="text" class="skill-specialization" placeholder="å°‚é–€åˆ†é‡"></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> çµŒç†</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> è€ƒå¤å­¦</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> å¿ƒç†å­¦</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> äººé¡å­¦</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ç”Ÿç‰©å­¦</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> åœ°è³ªå­¦</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> é›»å­å·¥å­¦</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> å¤©æ–‡å­¦</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> åšç‰©å­¦</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> ç‰©ç†å­¦</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> æ³•å¾‹</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> è–¬å­¦</label></li><li><input type="number" class="critical-counter" min="0" placeholder="0"><label><input type="checkbox"> æ­´å²</label></li><li><input type="text" class="custom-skill-input" placeholder="æŠ€èƒ½åã‚’å…¥åŠ›"><button class="add-skill-button">+</button></li></ul></div>
                <div class="skill-category"><h3>è‡ªç”±ãƒ¡ãƒ¢æ¬„</h3><textarea class="memo-area" placeholder="ã“ã“ã«è‡ªç”±ã«ãƒ¡ãƒ¢ã‚’è¨˜å…¥ã§ãã¾ã™"></textarea></div>`;
            
            const initialSheet = document.getElementById('char1');
            initialSheet.innerHTML = `<h2><div><span class="char-name" data-char-id="char1">æ¢ç´¢è€…1</span>ã®æŠ€èƒ½</div><button class="reset-button">ãƒªã‚»ãƒƒãƒˆ</button></h2>` + templateHolder.innerHTML;
            
            initialSheet.querySelector('.reset-button').addEventListener('click', resetSheet);
            document.querySelector('.delete-tab-button').addEventListener('click', deleteSheet);
            
            document.getElementById('mode-toggle-button').addEventListener('click', toggleWideMode);
            document.getElementById('layout-toggle-button').addEventListener('click', toggleLayoutMode);
            document.getElementById('add-tab-button').addEventListener('click', addCharSheet);
            document.querySelector('.tab-buttons').addEventListener('dblclick', handleNameEdit);
            document.getElementById('copy-summary-button').addEventListener('click', copySummary);
            document.getElementById('sheets-container').addEventListener('click', (event) => {
                if (event.target.classList.contains('add-skill-button')) addCustomSkill(event);
            });
            document.getElementById('sheets-container').addEventListener('input', updateSummary);
            
            document.querySelector('.tab-link.active').click();
        }

        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
